<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç QR-–∫–æ–¥–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        .qr-container { 
            margin: 20px 0; 
            padding: 20px;
            border: 2px solid #007AFF;
            border-radius: 10px;
            background: #f8f9fa;
        }
        .info { 
            background: #e9ecef; 
            padding: 15px; 
            border-radius: 5px;
            margin-bottom: 20px;
        }
        #qr-image {
            max-width: 300px;
            height: auto;
            border: 2px solid #333;
            padding: 10px;
            background: white;
        }
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ –¢–µ—Å—Ç QR-–∫–æ–¥–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</h1>
        
        <div class="info">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏:</h3>
            <p><strong>ID:</strong> <input type="number" id="equipment-id" value="6" style="width: 60px;"></p>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="status">–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</span></p>
        </div>

        <div class="qr-container">
            <h3>QR-–∫–æ–¥ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</h3>
            <div id="qr-result">
                <img id="qr-image" src="" alt="QR Code">
            </div>
            <p id="qr-info"></p>
        </div>

        <div>
            <button onclick="loadQRCode()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å QR-–∫–æ–¥</button>
            <button onclick="testScan()">üì± –¢–µ—Å—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</button>
            <button onclick="window.location.reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
        </div>

        <div id="test-result" style="margin-top: 20px;"></div>
    </div>

    <script>
        async function loadQRCode() {
            const equipmentId = document.getElementById('equipment-id').value;
            const statusElement = document.getElementById('status');
            const qrInfoElement = document.getElementById('qr-info');
            
            statusElement.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            statusElement.className = '';
            
            try {
                const response = await fetch(`http://localhost:5000/api/equipment/${equipmentId}/qr-code`);
                const data = await response.json();
                
                if (data.qr_code) {
                    document.getElementById('qr-image').src = data.qr_code;
                    qrInfoElement.textContent = `QR-–∫–æ–¥ –¥–ª—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è ID: ${data.equipment.id}, –ú–æ–¥–µ–ª—å: ${data.equipment.model_name}`;
                    qrInfoElement.className = 'success';
                    statusElement.textContent = '–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ';
                    statusElement.className = 'success';
                    console.log('QR-–∫–æ–¥ –∑–∞–≥—Ä—É–∂–µ–Ω:', data);
                } else {
                    qrInfoElement.textContent = 'QR-–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ—Ç–≤–µ—Ç–µ';
                    qrInfoElement.className = 'error';
                    statusElement.textContent = '–û—à–∏–±–∫–∞';
                    statusElement.className = 'error';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                qrInfoElement.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ QR-–∫–æ–¥–∞: ' + error.message;
                qrInfoElement.className = 'error';
                statusElement.textContent = '–û—à–∏–±–∫–∞';
                statusElement.className = 'error';
            }
        }

        async function testScan() {
            const equipmentId = document.getElementById('equipment-id').value;
            const resultElement = document.getElementById('test-result');
            
            resultElement.innerHTML = '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...';
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ QR-–∫–æ–¥–∞
                const qrResponse = await fetch(`http://localhost:5000/api/equipment/${equipmentId}/qr-code`);
                const qrData = await qrResponse.json();
                
                if (!qrData.qr_code) {
                    resultElement.innerHTML = '<div class="error">‚ùå QR-–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω</div>';
                    return;
                }

                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ QR-–∫–æ–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const scanResponse = await fetch('http://localhost:5000/api/equipment/qr-scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        qrData: JSON.stringify({
                            equipment_id: qrData.equipment.id,
                            serial_number: qrData.equipment.serial_number,
                            type: 'equipment'
                        })
                    }),
                });

                const scanResult = await scanResponse.json();

                if (scanResponse.ok) {
                    resultElement.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ –¢–µ—Å—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å–ø–µ—à–µ–Ω!</h3>
                            <p><strong>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ:</strong></p>
                            <p>–ú–æ–¥–µ–ª—å: ${scanResult.model_name}</p>
                            <p>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä: ${scanResult.serial_number}</p>
                            <p>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: ${scanResult.location}</p>
                            <p>–°—Ç–∞—Ç—É—Å: ${scanResult.status}</p>
                        </div>
                    `;
                } else {
                    resultElement.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ${scanResult.error}</div>`;
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞:', error);
                resultElement.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}</div>`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º QR-–∫–æ–¥ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadQRCode();
    </script>
</body>
</html>